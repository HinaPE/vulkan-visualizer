# Vulkan Visualizer 未来路线图（面向物理模拟可视化）

最后更新时间：2025-09-21

目标：在现有引擎-渲染器解耦、动态渲染与多呈现模式的稳定基础上，逐步补齐“数据接入—可视化通道—交互分析—输出自动化—性能与工程化—扩展生态”能力，打造一个轻量、可靠、可扩展的物理模拟可视化器。

注：本文档仅覆盖“未来要实现的功能”。已实现内容（Vulkan 设备/交换链/附件、EngineBlit/RendererComposite/DirectToSwapchain、ImGui HUD、截图、热重载钩子、GPU 帧级时间戳等）不再赘述。

---
## 1. 能力蓝图（未来规划）

- Engine Services 层（新增服务抽象）
  - UploadService：缓冲/纹理上传队列与暂存区（staging），支持异步/批量提交与复用。
  - ShaderService：着色器编译/缓存与宏配置，联动热重载与编译日志面板。
  - TimestampQueryService：细粒度 GPU 区段计时（上传/几何/合成/拣选），汇总到 HUD。
  - FileWatcherService：递归目录监视（跨平台），集中化对 Shader/Data/会话文件监听。
  - ScreenshotService：序列截图、高分辨率分块/超采样，统一无头接口复用。
  - PickingService：ID Pass（渲染 ID）与最近点（点/三角）混合方案；统一拾取 API。
  - CameraService：轨道/飞行/惯性、Fit、正交/透视、书签与插值动画。
  - DataRegistry：数据集/时间轴/几何/场/属性/单位与元数据的统一注册与查询。
  - JobSystem（轻量）：I/O/解析异步任务（线程池），防止主线程阻塞。

- Data/Scene 层
  - DataModel：Dataset(TimeSeries) → {Geometry(Points/Lines/TriMesh), Fields(scalars/vectors), Meta}，带缓存策略（最近 N 帧）。
  - SceneGraph/Layer：可视化图层（可见性/顺序）、渲染参数、色标配置、层级开关。

- 可视化渲染器（可插拔）
  - PointCloudRenderer：实例化/合批，按标量映射颜色/大小，分类调色板，百万级规模与 LOD。
  - Polyline/TrajectoryRenderer：折线/轨迹/箭头，按时间或标量着色，宽度控制。
  - TriMeshRenderer：顶点/面标量着色、法线/背面剔除、基础光照开关。
  - SliceRenderer（平面剖切）：任意平面剖切 + 伪彩贴图；后续扩展剖切盒/交互 Gizmo。
  - GlyphRenderer（可选）：向量场箭头/小圆锥/椭球，按量纲自动缩放与色映射。

- 标量映射与色标系统
  - 预置色标（Viridis/Turbo/Plasma/RdBu/Category10 等），线性/对数归一化。
  - 值域管理：全局/每图层/按选择集/按时间窗口自动；色标条（叠加/图层内），截图中保留。
  - 传递函数编辑器（后续）：支持多段与透明度控制。

- 交互分析
  - 拾取与选择：点/三角拾取、框选/圈选、按属性筛选；选择集管理与导出。
  - 测量工具：距离/角度/夹角、向量投影；剖切平面/剖切盒交互与读数。
  - 时间轴：播放/步进/循环/速度，关键帧相机与快照；缓存策略可调。

- 输出与自动化
  - 序列截图与高分辨率离屏（分块/超采样/抗锯齿）。
  - 无头渲染 CLI：加载数据/会话、设置相机、批量输出帧；像素一致性校验。
  - 会话保存/加载（JSON）：数据源、图层/色标、相机、布局与选项。
  - 可选视频导出：ffmpeg 管道（可选依赖，检测到即启用）。

- 性能与稳定性
  - 视锥剔除、层级包围盒、点/网格 LOD（屏幕空间误差）。
  - 异步 I/O 与解析、上传双缓冲、分块可视化（Level/Page）。
  - 统计/基准：FPS/DrawCall/GPU/CPU 时间、上传带宽与 VMA 预算；回归基准集。

- 扩展性与工程化
  - 插件化 Reader（动态库）接口与示例。
  - 脚本化接口（Python 或 Lua）：相机/时间轴/截图/导出等有限 API。
  - 跨平台构建与发布（Windows + Linux），CMake Presets 与依赖清单。
  - 崩溃日志/最小复现包（日志/会话/数据摘要），单元/集成测试与 CI。

---
## 2. 里程碑与交付（建议节奏）

说明：每个里程碑给出交付物/验收标准/主要风险。节奏与内容可滚动调整，优先稳定与可复现。

### M1 数据接入与时间序列（2–3 周）
- 交付物
  - Reader 基础：CSV、PLY、OBJ、STL、简化 VTK/VTU（ASCII/二进制子集）。
  - 数据集描述 JSON：声明几何/属性列、时间步目录/命名规则、单位/比例。
  - DataModel 与缓存：按时间步懒加载、最近 N 帧缓存、手动清理 API。
- 验收
  - 可加载 >1000 帧的点云/网格序列，播放流畅（可调缓存）。
- 风险
  - 不同格式解析复杂度差异；大文件 I/O 带来的卡顿。

### M1.5 相机与导航（1–2 周）
- 交付物
  - CameraService：轨道/飞行/惯性、Fit、正交/透视、书签与插值动画。
  - 世界坐标轴/地面网格（可开关）、单位比例（m/mm）。
- 验收
  - 百万点/三角规模交互顺滑；相机参数可导入导出。
- 风险
  - 多视口/DPI/输入法差异导致的交互一致性问题。

### M2 可视化图元与渲染通道（3–4 周）
- 交付物
  - PointCloudRenderer/PolylineRenderer/TriMeshRenderer/SliceRenderer（首版）。
  - 标量映射：预置色标库、线性/对数归一化；图层级渲染参数面板。
- 验收
  - 多图层组合渲染，1080p 下 60fps（规模与数据相关，指标按样例集制定）。
- 风险
  - LOD 与合批策略的稳定性与内存占用，Shader 分支过多带来的编译时间。

### M2.5 色标系统进阶（2 周）
- 交付物
  - 值域管理（全局/图层/选择集/时间窗口自动）；色标条（叠加/图层内）。
  - 截图/导出中保留图例；简单传递函数编辑器（可扩展透明度）。
- 验收
  - 切换色标/范围无明显卡顿；导出 PNG 的可读性一致。
- 风险
  - 大范围自动统计开销与缓存策略选择。

### M3 交互分析：拣选/选择/测量/时间轴（3–4 周）
- 交付物
  - PickingService：ID Pass + 最近点；框选/圈选与属性筛选，选择集管理与导出。
  - 测量工具：距离/角度/夹角/投影；剖切平面/盒交互。
  - 时间轴控件：播放/步进/循环/速度、关键帧相机。
- 验收
  - 百万级数据上拾取/选择流畅，测量结果可导出（CSV/JSON）。
- 风险
  - ID Pass 内存与带宽；多图层/多实例的 ID 方案设计。

### M4 输出与自动化（2–3 周）
- 交付物
  - 序列截图与高分辨率离屏（分块/超采样/抗锯齿）。
  - 无头渲染 CLI：指定会话/数据/相机/帧范围，批量输出；像素哈希对比。
  - 会话（JSON）：数据源、图层/色标、相机、布局；可在 UI/CLI 往返。
  - 可选：ffmpeg 管道（自动检测路径）。
- 验收
  - 无头/有头输出像素一致（容忍微小差异）；批处理在 CI 环境可跑通。
- 风险
  - 平台图形栈差异；高分辨率内存压力。

### M5 性能与稳定性（3–6 周，持续穿插）
- 交付物
  - 视锥剔除与层级包围盒；点/网格 LOD（基于屏幕误差）。
  - 异步 I/O 与解析、上传双缓冲、分块可视化；内存预算与回收策略。
  - HUD 性能页签：CPU/GPU 堆栈、DrawCall、合批命中率；基准数据集与回归报告。
- 验收
  - 目标硬件/数据规模下达到预期帧率目标并产出回归基线。
- 风险
  - 数据量与硬件差异大，指标需要分档定义与长期维护。

### M6 扩展与脚本（3–4 周）
- 交付物
  - Engine Services 对外接口定稿与文档。
  - Reader 插件示例（动态库）：自定义二进制流读入链路演示。
  - 轻量脚本（Python 或 Lua）：相机/时间轴/截图/导出等若干 API 绑定。
- 验收
  - 不改引擎源码，仅通过插件/脚本完成一个演示工作流。
- 风险
  - 绑定与 ABI 稳定性；跨平台脚本环境差异。

### M7 跨平台与发布（2–3 周）
- 交付物
  - Linux 构建验证（X11/Wayland 二选一），Vulkan SDK 检测与提示。
  - CMake Presets、第三方依赖 License 汇总；可移植压缩包（含示例数据与会话）。
- 验收
  - Windows + Linux 均可一键构建、运行示例与无头任务。
- 风险
  - 平台特性差异（多视口、输入法、DPI）。

---
## 3. 近期两周行动清单（落地优先）

- 完成 M1 的最小竖切：
  - CSV/PLY Reader 首实现；DataModel 骨架（时间序列缓存）；数据描述 JSON 草案。
  - UI 初版：数据/时间轴面板与加载状态提示；错误/日志面板统一入口。
- 相机基础（M1.5 的一部分）：轨道/飞行/Fit 与参数导入导出。
- 工程支撑：添加 CMake Presets（Release/RelWithDebInfo）、示例数据包与“上手 5 分钟”。

---
## 4. 不在范围（明确边界）

- 任何物理求解/仿真算法与数值计算；
- 复杂 DCC 编辑功能（拓扑编辑/布尔等）；
- 高端离线渲染（Path Tracing 等）——仅提供基础可视化光照与必要后处理。

---
## 5. 技术债与演进点（跟踪）

- RendererCaps → Services 的能力宣告整理（上传/查询/截图/拣选），避免耦合泄漏。
- Shader 构建与缓存：编译时间与宏组合爆炸风险；需要缓存/分层编译与最小热更。
- ID Pass 精度与内存：多层/多实例 ID 规划与压缩方案；
- 大图像/高分辨率输出的暂存分配与回收策略；
- 长时运行的内存/句柄泄漏追踪与告警（结合 VMA 与运行时快照）。
