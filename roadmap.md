# Vulkan Visualizer 未来路线图（面向物理模拟/科学可视化）

最后更新时间：2025-09-21

目标：在“稳定的引擎-渲染器解耦、动态渲染（VK 1.3）、多呈现模式、ImGui HUD、基础截图、文件热重载钩子、帧级 GPU 时间戳、相机导航（轨道/飞行/惯性/书签/导入导出）”等现有能力之上，系统性补齐“数据接入—可视化通道—交互分析—输出自动化—性能与工程化—扩展生态”，形成一个轻量、可靠、可扩展的可视化器。

说明：本文档仅规划“未来要做/要增强的事项”；已具备的通用图形框架能力不重复列出。

---
## 1. 能力蓝图（仅新增/增强）

- Engine Services（服务层，抽象与实现）
  - UploadService（新增）：统一缓冲/图像上传队列与 staging 池，支持批量、复用、生命周期回收；与 JobSystem 协同。
  - ShaderService（新增）：着色器编译/缓存/宏配置，热重载联动，编译日志与错误面板；支持本地/外部 glslc/DXC/Cache。
  - TimestampQueryService（增强）：从“帧级”扩展为“区段级”（上传/几何/合成/拣选/后处理），统一记录到 HUD。
  - FileWatcherService（增强）：跨平台、集中化（Shader/Data/会话文件），事件去抖动与批处理。
  - ScreenshotService（增强）：序列截图、高分辨率（分块/超采样/抗锯齿），统一接口（UI/CLI 复用）。
  - PickingService（新增）：ID Pass + 最近点（点/三角）混合方案；统一拾取/查询 API。
  - DataRegistry（新增）：数据集/时间轴/几何/场/单位与元数据的统一注册/查询。
  - JobSystem（新增）：轻量线程池用于 I/O/解析/上传前处理，避免主线程卡顿。

- Data/Scene 层（新增）
  - DataModel：Dataset(TimeSeries) → {Geometry(Points/Lines/TriMesh), Fields(scalars/vectors), Meta}；最近 N 帧缓存策略，可手动/自动回收。
  - SceneGraph/Layer：图层（可见性/顺序/参数），色标与渲染态配置，图层内统计缓存。

- 可视化渲染器（新增）
  - PointCloudRenderer：实例化/合批，标量映射颜色/大小，分类调色板，百万级与 LOD。
  - Polyline/TrajectoryRenderer：折线/轨迹/箭头，按时间或标量着色，线宽控制。
  - TriMeshRenderer：面/顶点标量着色、法线/剔除、基础光照开关。
  - SliceRenderer：任意平面剖切 + 伪彩；后续支持剖切盒与交互 Gizmo。
  - GlyphRenderer（可选）：向量场箭头/小圆锥/椭球，按量纲自动缩放与色映射。

- 标量映射与色标系统（新增）
  - 预置色标（Viridis/Turbo/Plasma/RdBu/Category10…），线性/对数归一化。
  - 值域管理：全局/图层/选择集/时间窗口自动；色标条（叠加/图层内），截图中保留。
  - 传递函数编辑器（后续）：多段/透明度控制。

- 交互分析（新增）
  - 拾取/选择：点/三角拾取、框选/圈选、按属性筛选；选择集管理与导出。
  - 测量：距离/角度/夹角/投影；剖切平面/盒交互与读数。
  - 时间轴：播放/步进/循环/速度、关键帧相机。
  - 导航辅助可视项：世界坐标轴/地面网格（可开关）、单位比例（m/mm）。

- 输出与自动化（增强）
  - 高分辨率离屏（分块/超采样/抗锯齿）与序列输出。
  - 无头 CLI：加载数据/会话、设置相机、批量输出帧；像素一致性校验。
  - 会话保存/加载：数据源、图层/色标、相机、布局/选项；UI/CLI 往返。
  - 可选视频导出：ffmpeg 管道（可选依赖自动启用）。

- 性能与稳定性（增强）
  - 视锥剔除、层级包围盒；点/网格 LOD（屏幕空间误差）。
  - 异步 I/O 与解析、上传双缓冲、分块可视化（Level/Page）。
  - 统计/基准：FPS/DrawCall/GPU/CPU 时间、上传带宽、VMA 预算与报警；回归基准集。

- 扩展性与工程化（新增/增强）
  - 插件化 Reader（动态库）接口与示例。
  - 轻量脚本绑定（Python 或 Lua）：相机/时间轴/截图/导出等有限 API。
  - 跨平台构建与发布（Windows + Linux），CMake Presets 与依赖清单；License 汇总。
  - 崩溃日志/最小复现包（日志/会话/数据摘要），单元/集成测试与 CI。

---
## 2. 里程碑与交付（建议节奏）

说明：每个里程碑给出交付物/验收标准/主要风险。节奏可滚动调整，优先稳定与可复现。

### M1 数据接入与时间序列（2–3 周）
- 交付物
  - Reader 基础：CSV、PLY、OBJ、STL、简化 VTK/VTU（ASCII/二进制子集）。
  - 数据集描述 JSON：声明几何/属性列、时间步目录/命名规则、单位/比例。
  - DataModel 与缓存：按时间步懒加载、最近 N 帧缓存、手动清理 API。
- 验收
  - 可加载 >1000 帧的点云/网格序列，播放流畅（缓存可调、诊断面板可见）。
- 风险
  - 不同格式解析复杂度；大文件 I/O 卡顿与内存峰值。

### M1.5 导航辅助可视与坐标体系（1–2 周）
- 交付物
  - 世界坐标轴/地面网格（可开关）、屏幕角落小坐标轴；单位比例（m/mm）与 UI 指示。
  - TimestampQueryService 粗粒度→细粒度打点的基础接入（上传/几何/合成）。
- 验收
  - 1080p 下辅助叠加开/关无明显开销；HUD 可展示子区段 GPU 时间。
- 风险
  - 不同 DPI/多视口一致性；叠加与合成阶段的同步/布局细节。

### M2 可视化图元与渲染通道（3–4 周）
- 交付物
  - PointCloudRenderer/PolylineRenderer/TriMeshRenderer/SliceRenderer（首版）。
  - 标量映射：预置色标库、线性/对数归一化；图层级渲染参数面板。
- 验收
  - 多图层组合渲染，1080p 下达到目标帧率（按样例集制定）；色标切换与范围调整无明显卡顿。
- 风险
  - LOD 与合批策略稳定性与内存占用；Shader 分支过多导致编译时间长。

### M2.5 色标系统进阶（2 周）
- 交付物
  - 值域管理（全局/图层/选择集/时间窗口自动）；色标条（叠加/图层内）。
  - 截图/导出中保留图例；传递函数编辑器（基础版，支持不透明度）。
- 验收
  - 导出 PNG 的可读性一致；图例布局与像素对齐一致。
- 风险
  - 大范围统计开销与缓存/降采样策略。

### M3 交互分析：拣选/选择/测量/时间轴（3–4 周）
- 交付物
  - PickingService：ID Pass + 最近点；框选/圈选与属性筛选，选择集管理与导出。
  - 测量：距离/角度/夹角/投影；剖切平面/盒交互。
  - 时间轴控件：播放/步进/循环/速度、关键帧相机（与现有相机动画打通）。
- 验收
  - 百万级数据上拾取/选择流畅；测量结果可导出（CSV/JSON）。
- 风险
  - ID Pass 内存与带宽；多图层/多实例 ID 方案设计；相机动画与时间轴联动。

### M4 输出与自动化（2–3 周）
- 交付物
  - 高分辨率离屏（分块/超采样/抗锯齿）与序列输出。
  - 无头渲染 CLI：指定会话/数据/相机/帧范围，批量输出；像素哈希对比。
  - 会话（JSON）：数据源、图层/色标、相机、布局；UI/CLI 往返。
  - 可选：ffmpeg 管道（自动检测路径）。
- 验收
  - 无头/有头输出像素一致（容忍微小差异）；批处理在 CI 环境可跑通。
- 风险
  - 平台图形栈差异；高分辨率内存/显存压力与临时缓冲回收。

### M5 性能与稳定性（3–6 周，持续穿插）
- 交付物
  - 视锥剔除与层级包围盒；点/网格 LOD（屏幕误差）。
  - 异步 I/O 与解析、上传双缓冲、分块可视化；内存预算与回收策略。
  - HUD 性能页签：CPU/GPU 堆栈、DrawCall、合批命中率；基准数据集与回归报告。
- 验收
  - 目标硬件/数据规模下达到预期帧率目标并产出回归基线。
- 风险
  - 数据量与硬件差异大，指标需分档定义与长期维护。

### M6 扩展与脚本（3–4 周）
- 交付物
  - Engine Services 对外接口定稿与开发文档。
  - Reader 插件示例（动态库）：自定义二进制流读入演示。
  - 轻量脚本（Python 或 Lua）：相机/时间轴/截图/导出等 API 绑定。
- 验收
  - 不改引擎源码，仅通过插件/脚本完成一个演示工作流。
- 风险
  - 绑定与 ABI 稳定性；跨平台脚本环境差异。

### M7 跨平台与发布（2–3 周）
- 交付物
  - Linux 构建验证（X11/Wayland 二选一），Vulkan SDK 检测与提示。
  - CMake Presets（Release/RelWithDebInfo）、第三方依赖 License 汇总；可移植压缩包（含示例数据与会话）。
- 验收
  - Windows + Linux 可一键构建、运行示例与无头任务。
- 风险
  - 平台特性差异（多视口、输入法、DPI）。

---
## 3. 近期两周行动清单（落地优先）

- 完成 M1 的最小竖切：
  - CSV/PLY Reader 首实现；DataModel 骨架（时间序列缓存）；数据描述 JSON 草案。
  - UI 初版：数据/时间轴面板与加载状态提示；统一错误/日志面板入口。
- 导航辅助（M1.5 的一部分）：世界坐标轴/地面网格叠加，单位比例指示。
- 工程支撑：添加 CMake Presets（Release/RelWithDebInfo）、样例数据包与“上手 5 分钟”。

---
## 4. 不在范围（明确边界）

- 任何物理求解/仿真算法与数值计算；
- 复杂 DCC 编辑（拓扑编辑/布尔等）；
- 高端离线渲染（Path Tracing 等）——仅提供基础光照与必要后处理。

---
## 5. 技术债与演进点（跟踪）

- RendererCaps → Services 的能力宣告梳理（上传/查询/截图/拣选），减少耦合泄漏。
- Shader 构建与缓存：编译时间与宏组合爆炸风险；需要缓存/分层编译与最小热更。
- ID Pass 精度与内存：多层/多实例 ID 规划与压缩；
- 大图像/高分辨率输出的暂存内存/显存与回收策略；
- 长时运行的内存/句柄泄漏追踪与告警（配合 VMA/运行时快照）。
