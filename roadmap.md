# Vulkan Visualizer 开发路线图（面向物理模拟可视化）

最后更新时间：2025-09-21

本路线图以“独立可视化器”为目标（不包含任何物理求解代码），聚焦于对各类物理模拟数据（流体/结构/粒子/电磁等）的高效、可靠、易用的可视化与交互。规划在不打破现有引擎-渲染器解耦基础上，循序渐进增强“数据接入—场景呈现—交互分析—输出与自动化—性能与稳定性—易用性与扩展性”。

---

## 一、当前能力（代码已具备）

基于对 `include/vk_engine.h` 与 `src/vk_engine.cpp` 的阅读，当前引擎具备：

- 底层与依赖
  - Vulkan 1.4.321 动态渲染、Synchronization2、时间线信号量（Timeline Semaphore）。
  - SDL3（窗口/输入），VkBootstrap（Instance/Device/Swapchain），VMA（内存分配）。
  - ImGui（Docking + 多视口）后端（SDL3 + Vulkan）。
- 引擎职责（VulkanEngine）
  - 设备/交换链生命周期、帧循环、同步、命令缓冲管理（支持可选异步 Compute 轨）。
  - 通过 RendererCaps 协商附件与呈现模式（EngineBlit/RendererComposite/DirectToSwapchain）。
  - 离屏附件创建（颜色/可选深度），基于动态渲染的绘制路径。
  - ImGui 集成与顶层 DockSpace/HUD 面板（交换链/设备/统计信息展示）。
- 基础工具
  - 可选 GPU 时间戳（帧级 begin/end）并在 HUD 显示。
  - 文件监视与热重载入口（VV_ENABLE_HOTRELOAD）。
  - 截图（PNG，交换链回读；路径：screenshots/）。
  - sRGB 显示开关（基于 swapchain SRGB 格式），可作为简易“伽马/Tonemap”开关。
- 构建与示例
  - CMake 选项：LOGGING/GPU_TIMESTAMPS/TONEMAP/SCREENSHOT/HOTRELOAD。
  - 最小示例 `examples/basic_window`（三角形，动态渲染）。

这些能力为可视化器打下可靠的图形基础与 UI 框架，但距离“面向物理模拟的数据可视化”仍缺少上层模块与工作流支持。

---

## 二、差距分析：成为物理模拟可视化器仍缺什么？

围绕典型需求（点云/网格/场/轨迹/张量、时间序列、测量、截图/视频、批处理与复现），主要缺口如下：

1) 数据接入与时间序列
- 通用文件读取：CSV（标量/向量表）、PLY/OBJ/STL（几何）、简单 VTK/VTU/VTK-ASCII（场数据），以及目录帧序列组织。
- 数据模型：统一抽象“数据集—时间轴—场/几何—属性”，支持逐帧加载、缓存与释放。
- 大数据友好：内存映射/分块/增量加载；属性强/弱类型映射；单位与元数据（time step、dt、scale、坐标系）。

2) 场景表示与渲染通道
- 基础图元渲染器：
  - 点云（位置/大小/颜色/类别），数百万级实例化与 LOD。
  - 线段/折线/轨迹（含箭头）、矢量 glyph（速度/力）。
  - 三角网格（顶点/面标量着色、满足法线/颜色/UV 的可选通道）。
  - 标量场可视化：平面切片/剖切盒、等值线（2D）与伪彩，后续体渲染可延后。
- 统一材质/着色路径：标量映射、法线/光照开关（基础即可）。

3) 标量映射与色标体系
- 预置色标（Viridis/Turbo/Plasma/RdBu/Category10 等）。
- 值域管理（全局/局部/按选择集/按时间自动），色标条显示与导出。
- 传递函数编辑（后续扩展透明度与多峰）。

4) 交互分析
- 摄像机系统：轨道/飞行、视图书签、对齐正交、Bounding Fit。
- 选择与拾取：点/三角形拾取、框选/圈选、选择集管理与属性查看。
- 测量工具：距离/角度/夹角、剖切平面/剖切盒交互。
- 时间轴：播放/步进/速度/循环、关键帧快照、缓存策略。

5) 输出与自动化
- 截图序列（PNG）、高分辨率离屏（超采样/分块）。
- 无头渲染与命令行：加载数据、设置相机、渲染 N 帧到目录。
- 会话保存/加载（布局、相机、图层可见性、色标设置等），结果可复现。
- 可选外部 ffmpeg 管道生成视频（在文档中标注为可选依赖）。

6) 性能与稳定性
- 视锥剔除、实例化合批、点/网格 LOD、异步上传与双缓冲。
- 内存与预算可视化（已接入 VMA，可增强预算与泄漏扫描面板）。
- 统计与基准（帧率、DrawCall、GPU/CPU 时间分布、热点）。

7) 扩展性与可维护性
- Engine Services 层（Upload/Shader/Query/FileWatcher/Screenshot/DataRegistry/Picking/Camera/JobSystem）。
- 插件化 Reader（DLL/SO 动态加载）、脚本化（Python/Lua 二选一，最小绑定）。
- 跨平台（Windows + Linux）构建与发布。

---

## 三、总体架构（不破坏现有解耦）

- Core Engine（现有）：Vulkan 上下文、交换链/附件、帧循环、呈现模式、ImGui 集成、基本统计与工具。
- Engine Services（新增）：
  - UploadService：缓冲与纹理上传队列、临时 staging、异步提交封装。
  - ShaderService：着色器管理、编译缓存、宏配置、热更联动。
  - TimestampQueryService：细粒度计时区段（渲染器/上传/合成）。
  - FileWatcherService：目录/文件递归 watcher（已具备骨架，提炼为服务）。
  - ScreenshotService：PNG 序列、高分屏分块；无头路径复用。
  - PickingService：ID Pass 或最近点查询，统一 API。
  - CameraService：相机控制、书签、对齐与 fit。
  - DataRegistry：注册/查询当前数据集、时间轴、属性与可视化通道。
  - JobSystem（轻量）：I/O 和解析异步任务，避免主线程卡顿。
- Data/Scene 层：
  - DataModel：Dataset(TimeSeries) -> {Geometry(Points/Lines/TriMesh), Fields(scalars/vectors), Meta}。
  - SceneGraph/Layer：可视化图层与可见性、渲染参数、色标配置。
- Renderers（可插拔）：PointCloudRenderer / PolylineRenderer / MeshRenderer / SliceRenderer / GlyphRenderer。
- UI 层：
  - 数据面板（数据/时间轴/属性）、场景层面板、色标与映射、相机与测量、日志与统计。

---

## 四、里程碑与交付（建议节奏）

说明：每个里程碑均给出“交付物/验收标准/风险”。优先保证稳定与可复现。

### M0.5 稳定化与地基优化（1–2 周）
- 交付物
  - 错误处理与日志：统一错误宏与崩溃日志（Windows：WER/MiniDump 选项，最小落地）。
  - HUD 加强：VMA 预算/占用细节、队列/提交统计、Swapchain 格式与 v-sync 状态。
  - DPI/多显示器缩放与输入一致性验证；窗口设置持久化（尺寸、位置、VSync）。
  - CMake 预设（Release/RelWithDebInfo）、可选禁用多视口以规避兼容问题。
- 验收
  - 示例长时间运行不卡死/无泄漏（>2 小时），截图与热更稳定。

### M1 数据接入与时间序列（2–3 周）
- 交付物
  - Reader 子系统（同步 API + 后续 Job 化）：CSV、PLY、OBJ、STL、简单 VTK/VTU（ASCII/二进制子集）。
  - 数据集描述 JSON（可选）：声明几何/属性列、时间步目录/命名规则、单位与比例。
  - DataModel 与缓存：按时间步懒加载、最近 N 帧缓存、手动清理。
  - 基础属性映射（位置/颜色/大小/标量/向量），单位/坐标系元数据。
- 验收
  - 通过目录帧序列加载 >1000 帧点云/网格，流畅播放（可调帧缓存）。

### M1.5 相机与导航（1–2 周）
- 交付物
  - 轨道/飞行/转台模式、WASD + 鼠标、惯性、Fit/书签、正交/透视切换。
  - 世界坐标轴/网格（可开关）、单位比例（m/mm 等）。
- 验收
  - 典型规模（百万点/百万三角）交互顺滑；相机参数可导入导出。

### M2 可视化图元与渲染通道（3–4 周）
- 交付物
  - PointCloudRenderer：实例化/合批、按标量映射颜色与大小、分类调色板。
  - Polyline/TrajectoryRenderer：带箭头/宽度、轨迹按时间着色。
  - TriMeshRenderer：按顶点/面标量着色、法线/背面剔除、简单光照开关。
  - SliceRenderer：任意平面剖切 + 伪彩；剖切交互 gizmo（后续）。
- 验收
  - 在同一场景组合多图元渲染，帧率稳定（1080p 60fps 目标，具体与数据量相关）。

### M2.5 标量映射与色标系统（2 周）
- 交付物
  - 预设色标库 + UI 选择、线性/对数归一化、固定/自适应范围。
  - 色标条组件（屏幕叠加/图层内）、截图中保留图例。
  - 选择集/时间自适应：按当前选择或时间窗口自动计算值域。
- 验收
  - 对不同数据集切换色标/范围无明显卡顿，导出的 PNG 可读性一致。

### M3 交互分析：选择/测量/时间轴（3–4 周）
- 交付物
  - PickingService：ID Pass 或最近点 CPU/GPU 混合方案，支持点/三角。
  - 选择集：框选/圈选/按属性筛选、集合保存与命名。
  - 属性面板：显示所选对象/元素的多维属性（标量/向量）。
  - 测量工具：点-点距离、角度、矢量投影；剖切平面/剖切盒交互。
  - 时间轴控件：播放/步进/循环/速度、关键帧相机。
- 验收
  - 在百万级数据上可流畅拾取/选择，测量结果可导出（CSV/JSON）。

### M4 输出与自动化（2–3 周）
- 交付物
  - 截图序列导出与高分辨率离屏（分块渲染），抗锯齿选项。
  - 无头渲染 CLI：指定会话/数据/相机/帧范围，批量输出。
  - 会话保存/加载（JSON）：数据源、图层/色标、相机、面板布局。
  - 可选：ffmpeg 管道（安装存在则启用），视频（mp4）输出。
- 验收
  - 命令行任务在 CI/无 GUI 环境可跑通，输出与有头一致（像素哈希近似）。

### M5 性能与稳定性（持续 3–6 周，穿插进行）
- 交付物
  - 视锥剔除/层级包围盒、点/网格 LOD（屏幕空间误差）。
  - 异步 I/O 与解析、上传双缓冲、分块可视化（大数据分 Level/Page）。
  - 统计与基准：采样一组标准数据集，记录 FPS/内存/上传带宽，回归基准。
  - HUD 性能页签：CPU/GPU 时间堆栈、DrawCall、合批命中率。
- 验收
  - 在目标硬件上达到既定规模下的帧率目标，并给出回归报告。

### M6 扩展与脚本（3–4 周）
- 交付物
  - Engine Services 对外接口定稿与文档。
  - Reader 插件（动态库）示例：自定义二进制流格式读入。
  - 轻量脚本：Python 或 Lua 二选一（先实现相机/时间轴/截图/导出），绑定少量 API。
- 验收
  - 不改引擎源码，以插件/脚本方式完成一个小型演示工作流。

### M7 跨平台与发布（2–3 周）
- 交付物
  - Linux 构建验证（X11/Wayland 路径择一），Vulkan SDK 检测与提示。
  - 可复用 CMake Presets、第三方依赖清单与 License 汇总。
  - 可移植压缩包发布（含示例数据与会话）。
- 验收
  - Windows + Linux 均可一键构建与运行示例。

### M8 质量与工程化（持续）
- 交付物
  - 单元测试（Reader/映射/几何处理）、集成测试（无头渲染像素哈希）。
  - Bench/Profiling 脚本；CI（GitHub Actions）基础流水线。
  - 崩溃回收与最小复现包自动化（日志/会话/数据摘要）。
- 验收
  - CI 通过基础构建与若干无头渲染对比；关键 Reader 覆盖核心分支。

---

## 五、UI 与可用性（贯穿全程）

- 面板分区：数据/时间轴、图层与可见性、色标映射、相机与测量、统计与日志。
- 键鼠约定：相机（Alt/Shift/Ctrl + 鼠标组合）、选择工具快捷键、时间轴快捷键。
- 主题与布局：默认深色主题，布局保存/恢复；多视口可选启用。
- 文档与“上手”：示例数据包、5 分钟上手指南、典型工作流（加载-选择-测量-截图）。

---

## 六、风险与取舍

- 体渲染/体数据：首期只做切片/等值线；真正的体光线投射与预积分放后期（M3+）。
- 透明度/排序：先用不透明路径与简单半透明，OIT（WBOIT）在 M2/M3 后段再考虑。
- 超大数据：优先点云/网格 LOD 与分块；内存外溢时考虑磁盘缓存。
- 跨平台差异：多视口、输入法、DPI；必要时提供“兼容模式”。

---

## 七、近期两周行动清单（落地导向）

- 完成 M0.5：
  - 崩溃日志与错误提示路径、HUD 扩展（预算/统计）。
  - 示例与 README：记录构建要求、Vulkan 驱动/SDK 检查、自检面板。
- 启动 M1：
  - Reader 接口与 CSV/PLY 首实现；数据描述 JSON 草案。
  - DataModel 骨架（时间序列缓存、属性映射）。
  - UI：数据/时间轴基础面板与加载状态提示。

---

## 八、不在范围（明确边界）

- 任何物理求解/仿真算法与数值计算；
- 复杂 DCC 编辑功能（拓扑编辑/重拓扑/布尔运算等）；
- 高端离线渲染器（Path Tracing 等）——仅提供基本可视化光照与后处理（可选）。

---

如需将以上里程碑细化为具体 Issue/任务列表（含预计工时与依赖图），可在本仓库创建 `milestones/` 与 `issues.md`，我将据此拆分到可执行的开发清单。
